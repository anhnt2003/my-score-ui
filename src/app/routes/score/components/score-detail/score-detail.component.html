<div class="contaienr-score-detail">
    @if(existedCategoryData$ | async; as existedCategory) {
        <div class="alert-dialog">
            <p-dialog header="Header" [visible]="existedCategory" [modal]="true" (visibleChange)="existedCategorySubject.next(false)"
                [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '50vw' }" [draggable]="true"
                [resizable]="false">
                <p>
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Magnam, deleniti, tenetur eaque aliquam eligendi numquam doloremque nisi laboriosam dolore qui, molestias ut rerum maiores voluptate doloribus exercitationem ipsam? Ea, in.
                </p>
            </p-dialog>
        </div>
    }
    <p-table #dt2 [value]="scoreDetailData" dataKey="id">
        <ng-template pTemplate="caption">
            <div class="search">
                <p-iconField iconPosition="left" class="ml-auto">
                    <p-inputIcon>
                        <i class="fa fa-search"></i>
                    </p-inputIcon>
                    <input pInputText type="text" placeholder="Tìm kiếm" />
                </p-iconField>
            </div>
        </ng-template>
        <ng-template pTemplate="header" let-data>
            <tr>
                <th>Email</th>
                @for(column of scoreDetailData[0]?.scoreArray; track column; let i = $index) {
                    <th>{{ column.categoryName }}</th>
                }
                <th></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-data>
            <tr>
                <td>{{ data.email }}</td>
                @for(column of scoreDetailData; track column; let i = $index) {
                    @for(score of column.scoreArray; track score; let j = $index) {
                        <td>{{ score.scoreCalculated }}</td>
                    }
                }
                <td><p-button (click)="openReviewDialog(data.userId)" label="Đánh giá người dùng" /></td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="5">No data found.</td>
            </tr>
        </ng-template>
    </p-table>
    <div class="pagination">
        <span class="mx-1 text-color">số lượng trong trang: </span>
        <p-dropdown [options]="pagingOptions.pageSizeOptions"
                    optionLabel="label" 
                    optionValue="value"
                    [(ngModel)]="pagingOptions.pageSize" 
                    (ngModelChange)="0" />
        <p-paginator [rows]="pagingOptions.pageSize" 
                     [totalRecords]="120" 
                     (onPageChange)="paginatorSubject.next()"
                     [showCurrentPageReport]="true" 
                     currentPageReportTemplate="{first} - {last} of {totalRecords}"
                     [showPageLinks]="false" [showFirstLastIcon]="false"></p-paginator>
    </div>
    <p-dialog class="dialog-container container" header="Thêm tiêu chí" [modal]="true" [(visible)]="reviewUserDialog" [draggable]="false">
        <span class="p-text-secondary block mb-5">Nhập điểm người dùng</span>
        <form [formGroup]="addScoreForm" (submit)="formSubmitSubject.next()">
            @for (category of categoriesSkill; track category) {
                <p-panel [header]="category.name" [toggleable]="true" [collapsed]="true">
                        <div formArrayName="entries">
                            @for (item of entries.controls; track $index) {
                                @if(category.categoryChildren[$index]?.name){
                                    <div [formGroupName]="$index">
                                        <p>{{category.categoryChildren[$index].name}}</p>
                                        <p-inputNumber (value)="userScore[$index].scoreEntered" formControlName="scoreEntered" mode="decimal" [minFractionDigits]="1"/>
                                    </div>
                                }
                                
                            }
                        </div>
                </p-panel>
            }
            <p-button type="submit" label="Xác nhận" />
        </form>
    </p-dialog>
</div>